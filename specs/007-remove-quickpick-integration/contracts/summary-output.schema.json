{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/NotMyself/claude-win11-speckit-update-skill/specs/007/summary-output.schema.json",
  "title": "SpecKit Update Summary Output",
  "description": "Schema for the Markdown summary output generated by the SpecKit update skill for user approval via Claude Code conversational workflow",
  "type": "object",
  "properties": {
    "currentVersion": {
      "type": "string",
      "pattern": "^v\\d+\\.\\d+\\.\\d+$",
      "description": "Currently installed SpecKit version from manifest (semantic version with 'v' prefix)",
      "examples": ["v0.0.71", "v1.2.3"]
    },
    "availableVersion": {
      "type": "string",
      "pattern": "^v\\d+\\.\\d+\\.\\d+$",
      "description": "Target SpecKit version to update to (semantic version with 'v' prefix)",
      "examples": ["v0.0.72", "v1.3.0"]
    },
    "filesToUpdate": {
      "type": "array",
      "description": "Files that will be updated (local unchanged, upstream changed)",
      "items": {
        "type": "string",
        "description": "Relative path from project root",
        "examples": [".claude/commands/speckit.tasks.md", ".specify/templates/spec-template.md"]
      },
      "uniqueItems": true
    },
    "filesToAdd": {
      "type": "array",
      "description": "New files from upstream not present locally",
      "items": {
        "type": "string",
        "description": "Relative path from project root"
      },
      "uniqueItems": true
    },
    "filesToRemove": {
      "type": "array",
      "description": "Files removed from upstream (present locally, marked as official)",
      "items": {
        "type": "string",
        "description": "Relative path from project root"
      },
      "uniqueItems": true
    },
    "conflicts": {
      "type": "array",
      "description": "Files with merge conflicts (local customized, upstream changed)",
      "items": {
        "type": "object",
        "properties": {
          "path": {
            "type": "string",
            "description": "Relative path from project root"
          },
          "userChangeSummary": {
            "type": "string",
            "description": "Brief description of local modifications",
            "maxLength": 200,
            "examples": ["Added custom deployment steps", "Modified validation rules"]
          },
          "upstreamChangeSummary": {
            "type": "string",
            "description": "Brief description of upstream changes",
            "maxLength": 200,
            "examples": ["New dependency tracking section", "Updated template structure"]
          }
        },
        "required": ["path", "userChangeSummary", "upstreamChangeSummary"]
      },
      "uniqueItems": true
    },
    "filesPreserved": {
      "type": "array",
      "description": "Files customized locally with no upstream changes (preserved as-is)",
      "items": {
        "type": "string",
        "description": "Relative path from project root"
      },
      "uniqueItems": true
    },
    "backupPath": {
      "type": "string",
      "description": "Relative path to timestamped backup directory",
      "pattern": "^\\.specify/backups/\\d{4}-\\d{2}-\\d{2}_\\d{2}-\\d{2}-\\d{2}/$",
      "examples": [".specify/backups/2025-10-21_14-22-10/"]
    },
    "customCommands": {
      "type": "array",
      "description": "User-created custom commands (never overwritten)",
      "items": {
        "type": "string",
        "description": "Relative path from project root",
        "pattern": "^\\.claude/commands/[^/]+\\.md$"
      },
      "uniqueItems": true
    }
  },
  "required": [
    "currentVersion",
    "availableVersion",
    "filesToUpdate",
    "conflicts",
    "backupPath"
  ],
  "additionalProperties": false,
  "examples": [
    {
      "currentVersion": "v0.0.71",
      "availableVersion": "v0.0.72",
      "filesToUpdate": [
        ".claude/commands/speckit.tasks.md",
        ".specify/templates/spec-template.md"
      ],
      "filesToAdd": [],
      "filesToRemove": [],
      "conflicts": [
        {
          "path": ".claude/commands/speckit.plan.md",
          "userChangeSummary": "Added custom tech stack review section",
          "upstreamChangeSummary": "New architecture validation step added"
        }
      ],
      "filesPreserved": [
        ".specify/memory/constitution.md"
      ],
      "backupPath": ".specify/backups/2025-10-21_14-22-10/",
      "customCommands": [
        ".claude/commands/custom-deploy.md"
      ]
    }
  ],
  "definitions": {
    "markdownOutput": {
      "type": "string",
      "description": "Markdown-formatted summary output with specific structure",
      "pattern": "^## SpecKit Update Summary[\\s\\S]*\\[PROMPT_FOR_APPROVAL\\]$",
      "contentMediaType": "text/markdown",
      "comment": "The Markdown output follows this structure:\n\n## SpecKit Update Summary\n\n**Current Version**: {currentVersion}\n**Available Version**: {availableVersion}\n\n### Files to Update ({count})\n- {path}\n[...]\n\n### Conflicts Detected ({count})\n- {path}\n  * Local: {userChangeSummary}\n  * Upstream: {upstreamChangeSummary}\n[...]\n\n### Backup Location\n{backupPath}\n\n---\n[PROMPT_FOR_APPROVAL]"
    }
  }
}
